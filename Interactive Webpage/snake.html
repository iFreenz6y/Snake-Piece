<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Snake Evolution Game with Boss</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { background:#000; }
  canvas { background:#000; border-radius:8px; box-shadow:0 10px 30px rgba(0,255,0,0.4); }
  .hud { font-family: Inter, ui-sans-serif, system-ui; }
  .flicker {
    animation: flicker 0.15s infinite alternate;
  }
  @keyframes flicker {
    from { box-shadow: inset 0 0 30px rgba(255,0,0,0.7); }
    to { box-shadow: inset 0 0 60px rgba(255,0,0,0.2); }
  }
</style>
</head>
<body class="min-h-screen flex items-center justify-center">

  <!-- üéµ Background + Sound Effects -->
  <audio id="bgMusic" src="m1.mp3" loop></audio>
  <audio id="eatSound" src="crunch.mp3"></audio>
  <audio id="deadSound" src="oof.mp3"></audio>

  <div class="flex flex-col items-center gap-4">
    <div class="flex gap-6 items-center hud text-green-400">
      <div class="text-xl font-semibold">üêç Snake Evolution</div>
      <div id="info" class="text-sm text-green-500">WASD / Arrows ‚Äî Don't hit yourself</div>
      <div id="score" class="text-sm font-mono bg-black border border-green-500 px-3 py-1 rounded">Score: 0</div>
      <div id="hp" class="text-sm font-mono bg-black border border-green-500 px-3 py-1 rounded">HP: 3</div>
    </div>

    <canvas id="game" width="900" height="520"></canvas>

    <div class="flex gap-3">
      <button id="startBtn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded">Start / Restart</button>
    </div>

    <div id="overlay" class="mt-2 text-xs text-green-600">
      Tip: Every 25 score = scarier evolution üßü‚Äç‚ôÇÔ∏è + Ogre Boss appears for 30s! Golden fruits heal +1 HP ‚≠ê <br>
      ‚öîÔ∏è When boss appears, barriers activate ‚Äî no wrapping outside!
    </div>
  </div>

<script>
/* ---------------------
   Snake Evolution Game + Boss
   --------------------- */

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const scoreEl = document.getElementById('score');
const hpEl = document.getElementById('hp');
const startBtn = document.getElementById('startBtn');

let running = false;

// CONFIG
const GRID_SIZE = 20;
const START_LENGTH = 3;
const MAX_SCORE = 99999;
const FRUITS = ['üçé','üçá','ü•≠'];
const GOLDEN_FRUIT = '‚≠ê';
const HAT_EMOJI = 'üëí';
const BOSS_EMOJI = 'üëπ';

let snake, direction, nextDirection, food, goldenFood, score, hp;
let snakeColor, hornLevel;
let boss = null; 
let bossMoveCounter = 0; 
let bossSpeed = 5; 
let barriersActive = false;

const bgMusic = document.getElementById("bgMusic");
const eatSound = document.getElementById("eatSound");
const deadSound = document.getElementById("deadSound");

// Reset game
function startGame() {
  snake = [];
  for (let i=0;i<START_LENGTH;i++) {
    snake.push({x:10-i, y:10});
  }
  direction = {x:1,y:0};
  nextDirection = {x:1,y:0};
  score = 0;
  hp = 3;
  hornLevel = 0;
  snakeColor = "#22c55e"; 
  goldenFood = null;
  boss = null;
  barriersActive = false;
  spawnFood();
  running = true;
  updateHUD();

  bgMusic.pause();
  bgMusic.currentTime = 0;

  requestAnimationFrame(loop);
}

function spawnFood() {
  const cols = Math.floor(canvas.width/GRID_SIZE);
  const rows = Math.floor(canvas.height/GRID_SIZE);
  food = {
    x: Math.floor(Math.random()*cols),
    y: Math.floor(Math.random()*rows),
    type: FRUITS[Math.floor(Math.random()*FRUITS.length)]
  };

  if (Math.random() < 0.1 && score > 0 && score % 50 !== 0) {
    goldenFood = {
      x: Math.floor(Math.random()*cols),
      y: Math.floor(Math.random()*rows),
      type: GOLDEN_FRUIT
    };
  } else {
    goldenFood = null;
  }
}

function updateHUD() {
  scoreEl.textContent = `Score: ${score}`;
  hpEl.textContent = `HP: ${hp}`;
}

function loop() {
  if (!running) return;

  direction = nextDirection;
  const head = {x:snake[0].x+direction.x, y:snake[0].y+direction.y};

  const cols = Math.floor(canvas.width/GRID_SIZE);
  const rows = Math.floor(canvas.height/GRID_SIZE);

  if (barriersActive) {
    if (head.x < 0 || head.x >= cols || head.y < 0 || head.y >= rows) {
      gameOver("Crashed into barrier!");
      return;
    }
  } else {
    if (head.x<0) head.x=cols-1;
    if (head.x>=cols) head.x=0;
    if (head.y<0) head.y=rows-1;
    if (head.y>=rows) head.y=0;
  }

  for (let i=0;i<snake.length;i++) {
    if (snake[i].x===head.x && snake[i].y===head.y) {
      hp--;
      if (hp<=0) {
        gameOver("You bit yourself!");
        return;
      }
    }
  }

  snake.unshift(head);

  if (head.x===food.x && head.y===food.y) {
    score = Math.min(MAX_SCORE, score+1);
    spawnFood();
    eatSound.currentTime = 0; eatSound.play().catch(()=>{});
    if (score % 25 === 0) evolveSnake();
  } else if (goldenFood && head.x===goldenFood.x && head.y===goldenFood.y) {
    hp++;
    goldenFood = null;
    eatSound.currentTime = 0; eatSound.play().catch(()=>{});
  } else {
    snake.pop();
  }

  if (boss) updateBoss(head);

  updateHUD();

  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawGrid();
  drawSnake(head);

  ctx.font="18px serif";
  ctx.fillText(food.type, food.x*GRID_SIZE+GRID_SIZE/2, food.y*GRID_SIZE+GRID_SIZE/2);
  if (goldenFood) ctx.fillText(goldenFood.type, goldenFood.x*GRID_SIZE+GRID_SIZE/2, goldenFood.y*GRID_SIZE+GRID_SIZE/2);

  if (boss) {
    ctx.font="40px serif"; 
    ctx.fillText(BOSS_EMOJI, boss.x*GRID_SIZE+GRID_SIZE/2, boss.y*GRID_SIZE+GRID_SIZE/2);
    drawBarrier();
  }

  setTimeout(()=>requestAnimationFrame(loop),100);
}

function drawSnake(head){
  ctx.fillStyle = snakeColor;
  snake.forEach((seg, i) => {
    ctx.beginPath();
    ctx.arc(seg.x * GRID_SIZE + GRID_SIZE/2, seg.y * GRID_SIZE + GRID_SIZE/2, GRID_SIZE/2 - 2, 0, Math.PI*2);
    ctx.fill();
  });

  const hx = head.x*GRID_SIZE+GRID_SIZE/2;
  const hy = head.y*GRID_SIZE+GRID_SIZE/2;
  ctx.fillStyle = snakeColor;
  ctx.beginPath();
  ctx.arc(hx, hy, GRID_SIZE/2, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle = "#fff";
  ctx.beginPath();
  ctx.arc(hx-5, hy-5, 3, 0, Math.PI*2);
  ctx.arc(hx+5, hy-5, 3, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle = "#000";
  ctx.beginPath();
  ctx.arc(hx-5, hy-5, 1.5, 0, Math.PI*2);
  ctx.arc(hx+5, hy-5, 1.5, 0, Math.PI*2);
  ctx.fill();

  ctx.font="16px serif";
  ctx.textAlign="center"; ctx.textBaseline="middle";
  ctx.fillText(HAT_EMOJI, hx, hy-18);

  if (hornLevel > 0) {
    ctx.fillStyle = "#fff";
    ctx.beginPath();
    ctx.moveTo(hx-8, hy-15);
    ctx.lineTo(hx-14, hy-28);
    ctx.lineTo(hx-4, hy-20);
    ctx.closePath();
    ctx.fill();

    ctx.beginPath();
    ctx.moveTo(hx+8, hy-15);
    ctx.lineTo(hx+14, hy-28);
    ctx.lineTo(hx+4, hy-20);
    ctx.closePath();
    ctx.fill();
  }
}

function drawGrid(){
  ctx.strokeStyle="rgba(0,255,0,0.2)";
  ctx.lineWidth=1;
  for (let x=0;x<canvas.width;x+=GRID_SIZE){
    ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();
  }
  for (let y=0;y<canvas.height;y+=GRID_SIZE){
    ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();
  }
}

function evolveSnake(){
  snakeColor = "#ff0000"; 
  hornLevel++;
  spawnBoss();
}

function spawnBoss(){
  const cols = Math.floor(canvas.width/GRID_SIZE);
  const rows = Math.floor(canvas.height/GRID_SIZE);
  boss = { x: Math.floor(Math.random()*cols), y: Math.floor(Math.random()*rows) };
  barriersActive = true;

  if (score <= 75) bossSpeed = Math.max(2, bossSpeed-1);

  canvas.classList.add("flicker");
  bgMusic.currentTime = 0;
  bgMusic.play().catch(()=>{});

  setTimeout(()=>{ boss=null; barriersActive = false; canvas.classList.remove("flicker"); bgMusic.pause(); bgMusic.currentTime=0; }, 30000);
}

function updateBoss(head){
  if (!boss) return;
  bossMoveCounter++;
  if (bossMoveCounter % bossSpeed !== 0) return; 

  if (boss.x < head.x) boss.x++;
  else if (boss.x > head.x) boss.x--;
  if (boss.y < head.y) boss.y++;
  else if (boss.y > head.y) boss.y--;

  if (boss.x === head.x && boss.y === head.y) {
    gameOver("The ogre stole your hat!");
  }
}

function drawBarrier(){
  ctx.strokeStyle="red";
  ctx.lineWidth=4;
  ctx.strokeRect(0,0,canvas.width,canvas.height);
}

function gameOver(msg){
  running = false;
  bgMusic.pause();
  bgMusic.currentTime = 0;
  deadSound.currentTime = 0; deadSound.play().catch(()=>{});
  alert("Game Over! " + msg + " Final Score: " + score);
}

window.addEventListener('keydown',(e)=>{ 
  const k=e.key.toLowerCase();
  if (k==='w'||k==='arrowup'){ if(direction.y===0) nextDirection={x:0,y:-1}; }
  if (k==='s'||k==='arrowdown'){ if(direction.y===0) nextDirection={x:0,y:1}; }
  if (k==='a'||k==='arrowleft'){ if(direction.x===0) nextDirection={x:-1,y:0}; }
  if (k==='d'||k==='arrowright'){ if(direction.x===0) nextDirection={x:1,y:0}; }
  if (!running) startGame();
});

startBtn.addEventListener('click',startGame);
</script>
</body>
</html>
